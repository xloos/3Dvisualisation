<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VR and PC Controls Example</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
</head>
<body>
  
  <a-scene physics="gravity: -9.8; debug: true" vr-mode-ui="enabled: true">
    <a-assets>
      <!-- Asset Items Here -->
      <a-asset-item id="zastrcka" src="zastrcka.glb"></a-asset-item>
      <a-asset-item id="PScable" src="PScable.glb"></a-asset-item>
      <a-asset-item id="krytnacpu" src="krytnacpu.glb"></a-asset-item>
      <a-asset-item id="cpu" src="cpu.glb"></a-asset-item>
      <a-asset-item id="ram" src="ram.glb"></a-asset-item>
      <a-asset-item id="ssd" src="ssd.glb"></a-asset-item>
      <a-asset-item id="srobzakladna" src="srobzakladna.glb"></a-asset-item>
      <a-asset-item id="motherboard" src="motherboard.glb"></a-asset-item>
      <a-asset-item id="PS" src="PS.glb"></a-asset-item>
      <a-asset-item id="notepad" src="notepad.glb"></a-asset-item>
      <a-asset-item id="screwdriver" src="screwdriver.glb"></a-asset-item>
      <a-asset-item id="tool_trolleys" src="tool_trolleys.glb"></a-asset-item>
      <a-asset-item id="lamp" src="lamp.glb"></a-asset-item>
      <a-asset-item id="woodencase" src="woodencase.glb"></a-asset-item>
      <a-asset-item id="GPU" src="GPU.glb"></a-asset-item>
      
      <img id="check_box" src="check_box.png">
      <img id="check" src="check.png">
      <img id="arrow" src="arrow.png">  <!-- Nový obrázok šípky -->

      <!-- Hand models -->
      <a-asset-item id="hand-left" src="https://cdn.aframe.io/controllers/oculus/oculus-touch-controller-left.gltf"></a-asset-item>
      <a-asset-item id="hand-right" src="https://cdn.aframe.io/controllers/oculus/oculus-touch-controller-right.gltf"></a-asset-item>
    </a-assets>
    
    <a-entity environment="preset: tron; groundColor: #445; skyColor: #88c;"></a-entity>

    <a-entity id="camera" camera look-controls wasd-controls="acceleration: 10" position="0 1.6 0" dynamic-body>
      <a-entity hand-controls="hand: left; handModelStyle: lowPoly; color: #ffcccc" gltf-model="#hand-left"></a-entity>
      <a-entity hand-controls="hand: right; handModelStyle: lowPoly; color: #ffcccc" gltf-model="#hand-right"></a-entity>
      <a-entity gltf-model="#notepad" position="-0.6 -0.25 -0.6" rotation="80 15 0" scale="0.4 0.4 0.4" dynamic-body>
        
        <!-- Text with custom font -->
        
        <a-entity text="value: ; color: #FFFFFF; shader: msdf; font: https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/justanotherhand/JustAnotherHand-Regular.json;" id="step1" position="0.206 0.098 -0.094" rotation="-90 0 0" width="1.5" align="left"></a-entity>
       
        <a-entity text="value: ; color: #FFFFFF; shader: msdf; font: https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/justanotherhand/JustAnotherHand-Regular.json;" id="step2" position="0 0.15 0.1" width="1.5" align="left"></a-entity>
        <a-entity text="value: ; color: #FFFFFF; shader: msdf; font: https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/justanotherhand/JustAnotherHand-Regular.json;" id="step3" position="0 0.05 0.1" width="1.5" align="left"></a-entity>
        <a-image id="check1" src="#check_box" position="0.025 0.140 0.185" rotation="-90 0 0" scale="0.25 0.25 0.25">
          <a-image src="#check" position="0 0 0" rotation="0 0 0" scale="0.8 0.8 0.8" visible="false"></a-image>
        </a-image>
      </a-entity>
    
      <a-entity geometry="primitive: ring; radiusInner: 0.005; radiusOuter: 0.01" position="0 0 -1" material="color: #FFFFFF; shader: flat"></a-entity>
    </a-entity>

    <!-- Objects and Lights -->
    <a-entity gltf-model="#lamp" shadow="cast: true; receive: true" position="2 4.5 -3.5" scale="2 2 2" rotation="0 0 0">
      <a-light type="spot" castShadow="true" color="#FFF" intensity="0.5" distance="10" decay="1" 
              position="-0.1 0.2 0" rotation="-90 0 0" angle="90"></a-light>
    </a-entity>

    <a-entity gltf-model="#lamp" shadow="cast: true; receive: true" position="-2 4.5 -3.5" scale="2 2 2" rotation="0 0 0">
      <a-light type="spot" castShadow="true" color="#FFF" intensity="0.5" distance="10" decay="1" 
              position="0 0.2 0" rotation="-90 0 0" angle="90"></a-light>
    </a-entity>

    <a-entity position="-5 0 -3" static-body>
      <a-entity id="pivot-wrapper" position="0 1 0" rotation="0 90 0">
        <a-entity gltf-model="#tool_trolleys" position="0 0 0" scale="1 1 1" rotation="0 0 0" static-body></a-entity>
      </a-entity>
    </a-entity>

    <!-- Modely a objekty s textami -->
    <a-entity id="motherboard" gltf-model="#motherboard" position="-1.162 1.033 -3.121" scale="2 2 2" rotation="-90 0 0" dynamic-body>
      <a-text value="Motherboard" position="0 0.193 0" align="center" color="#FFFFFF" scale="0.33 0.33 0.33" face-camera 
              font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/anton/Anton-Regular.json" shader="msdf" outline-width="0.05" outline-color="#000"></a-text>
    </a-entity>

    <a-entity id="PScable" gltf-model="#PScable" position="-1.965 1.483 -2.806" scale="2 2 2" rotation="180 -2.350 -16.4" dynamic-body soft-body>
      
    </a-entity>

    <a-entity id="PS" gltf-model="#PS" position="-2.466 1.103 -2.910" scale="2 2 2" rotation="0 90 0" dynamic-body>
      <a-text value="Power Supply" position="0 0.119 0" align="center" color="#FFFFFF" scale="0.1 0.1 0.1" face-camera
              font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/anton/Anton-Regular.json" shader="msdf" outline-width="0.05" outline-color="#000"></a-text>
    </a-entity>

    <a-entity id="ram" gltf-model="#ram" position="-1.852 0.999 -2.890" scale="2 2 2" rotation="0 90 90" dynamic-body>
      <a-text value="RAM" position="0 -0.072 0" align="center" color="#FFFFFF" scale="0.05 0.05 0.05" face-camera
              font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/anton/Anton-Regular.json" shader="msdf" outline-width="0.05" outline-color="#000"></a-entity>

    <a-entity id="krytnacpu" gltf-model="#krytnacpu" position="-0.062 1.687 -3.893" scale="2 2 2" rotation="90 0 0" dynamic-body>
      </a-entity>

    <a-entity id="srobzakladna" gltf-model="#srobzakladna" position="0.298 0.471 -3.815" scale="2 2 2" rotation="0 90 0" dynamic-body>
      <a-text value="Base Screw" position="0 0.3 0" align="center" color="#FFFFFF" scale="0.33 0.33 0.33" face-camera
              font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/anton/Anton-Regular.json" shader="msdf" outline-width="0.05" outline-color="#000"></a-entity>

    <a-entity id="ssd" gltf-model="#ssd" position="-1.742 0.994 -2.838" scale="2 2 2" rotation="0 90 90" dynamic-body>
      <a-text value="SSD" position="0 -0.063 0" align="center" color="#FFFFFF" scale="0.05 0.05 0.05" face-camera
              font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/anton/Anton-Regular.json" shader="msdf" outline-width="0.05" outline-color="#000"></a-entity>

    <a-entity id="woodencase" gltf-model="#woodencase" position="1.482 1.480 -3.145" scale="2 2 2" rotation="0 0 0" dynamic-body>
      <a-text value="Wooden Case" position="0 0.3 0" align="center" color="#FFFFFF" scale="0.33 0.33 0.33" face-camera
              font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/anton/Anton-Regular.json" shader="msdf" outline-width="0.05" outline-color="#000"></a-entity>

    <a-entity id="screwdriver" gltf-model="#screwdriver" position="0.649 1.012 -3.197" scale="2 2 2" rotation="0 0 0" dynamic-body>
      <a-text value="Screwdriver" position="0 0.03 0" align="center" color="#FFFFFF" scale="0.1 0.1 0.1" face-camera
              font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/anton/Anton-Regular.json" shader="msdf" outline-width="0.05" outline-color="#000"></a-entity>

    <a-entity id="cpu" gltf-model="#cpu" position="-1.598 0.991 -2.831" scale="2 2 2" rotation="-90 0 0" dynamic-body>
      <a-text value="CPU" position="0 0.053 0" align="center" color="#FFFFFF" scale="0.05 0.05 0.05" face-camera
              font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/anton/Anton-Regular.json" shader="msdf" outline-width="0.05" outline-color="#000"></a-entity>

    <a-entity id="zastrcka" gltf-model="#zastrcka" position="-5 0.136 -3.655" scale="2 2 2" rotation="0 53.230 0" dynamic-body>
      <a-text value="Plug" position="0 0.3 0" align="center" color="#FFFFFF" scale="0.33 0.33 0.33" face-camera
              font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/anton/Anton-Regular.json" shader="msdf" outline-width="0.05" outline-color="#000"></a-entity>

    <a-entity id="GPU" gltf-model="#GPU" position="-2.100 1.025 -3.037" scale="2 2 2" rotation="180 90 0" dynamic-body>
      <a-text value="GPU" position="0.028 -0.086 -0.027" align="center" color="#FFFFFF" scale="0.2 0.2 0.2" face-camera
              font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/anton/Anton-Regular.json" shader="msdf" outline-width="0.05" outline-color="#000"></a-entity>

    <!-- Pridanie ďalších svetiel pre lepšie osvetlenie -->
    <a-light type="ambient" color="#888" intensity="0.5"></a-light>
    <a-light type="directional" intensity="0.2" position="-1 1 0"></a-light>

    <!-- Skript na zobrazovanie názvov objektov pri priblížení a spracovanie krokov -->
    <script>
      AFRAME.registerComponent('face-camera', {
        tick: function () {
          var cameraEl = document.querySelector('[camera]');
          var cameraPosition = cameraEl.object3D.position;
          this.el.object3D.lookAt(cameraPosition);
        }
      });

      AFRAME.registerComponent('show-name-on-hover', {
        schema: {
          distance: {type: 'number', default: 2}
        },
        init: function() {
          this.cameraEl = document.querySelector('[camera]');
        },
        tick: function() {
          var cameraPos = new THREE.Vector3();
          var objectPos = new THREE.Vector3();
          this.el.object3D.getWorldPosition(objectPos);
          this.cameraEl.object3D.getWorldPosition(cameraPos);

          var distance = cameraPos.distanceTo(objectPos);

          if (distance < this.data.distance && this.el.children.length > 0) {
            this.el.children[0].setAttribute('visible', 'true');
          } else if (this.el.children.length > 0) {
            this.el.children[0].setAttribute('visible', 'false');
          }
        }
      });

      document.querySelectorAll('a-entity[gltf-model]').forEach(function(el) {
        el.setAttribute('show-name-on-hover', '');
      });

      // Texty pre jednotlivé kroky
      const steps = [
        "1. Clean the workspace: Before starting the assembly, ensure that your workspace is clean and dust-free.",
        "2. Organize tools: Make sure you have all the necessary tools (screwdriver, tweezers, etc.) and components ready.",
        "3. Safety: Check that the space is well-lit and you have access to grounding to prevent static electricity.",
        "4. Place the motherboard: Carefully place the motherboard into the case.",
        "5. Install the CPU: Insert the CPU into the motherboard socket and secure it.",
        "6. Add RAM: Insert the RAM modules into the motherboard slots.",
        "7. Mount the PSU: Install the power supply unit into the case.",
        "8. Connect cables: Connect all necessary cables from the PSU to the motherboard, CPU, and other components."
      ];

      let currentStep = 0;
      const maxLineLength = 30;  // Definovanie maxLineLength

      function updateStep() {
        if (currentStep < steps.length) {
          typeText(steps[currentStep], '#step1', 50);
          
          resetEffects();  // Najprv resetovať všetky efekty

          // Pridajte vizuálne zmeny pre každý krok
          if (currentStep === 0) {
            // Krok 1: Žiadne zvýraznenie
          }
          if (currentStep === 1) {
            // Krok 2: Žiadne zvýraznenie
          }
          if (currentStep === 2) {
            // Krok 3: Žiadne zvýraznenie
          }
          if (currentStep === 3) {
            highlightObject('#motherboard');
          }
          if (currentStep === 4) {
            highlightObject('#cpu');
          }
          if (currentStep === 5) {
            highlightObject('#ram');
          }
          if (currentStep === 6) {
            highlightObject('#PS');
          }
          if (currentStep === 7) {
            highlightObject('#PScable');
          }

          currentStep++;
        }
      }

      function previousStep() {
        if (currentStep > 1) {
          currentStep--;  // Znížime krok, aby sme sa vrátili späť
          typeText(steps[currentStep - 1], '#step1', 50);  // Zobrazí sa text predchádzajúceho kroku

          resetEffects();  // Najprv resetovať všetky efekty

          // Pridajte zmeny pre návrat k predchádzajúcemu kroku
          if (currentStep === 3) {
            highlightObject('#motherboard');
          }
          if (currentStep === 4) {
            highlightObject('#cpu');
          }
          if (currentStep === 5) {
            highlightObject('#ram');
          }
          if (currentStep === 6) {
            highlightObject('#PS');
          }
          if (currentStep === 7) {
            highlightObject('#PScable');
          }
        }
      }

      function resetEffects() {
        // Resetuje efekty pre všetky objekty
        const components = ['#motherboard', '#cpu', '#ram', '#PS', '#PScable'];
        components.forEach(id => {
          // Odstránenie animácie
          document.querySelector(id).removeAttribute('animation__scale');

          // Odstránenie šípky
          let arrow = document.querySelector(id + ' > a-image[src="#arrow"]');
          if (arrow) {
            arrow.parentNode.removeChild(arrow);
          }
        });
      }

      function highlightObject(objectId) {
        // Pridanie pulzujúcej animácie (mierne zväčšovanie a zmenšovanie)
        document.querySelector(objectId).setAttribute('animation__scale', {
          property: 'scale',
          dir: 'alternate',
          dur: 1000,
          loop: true,
          to: '1.2 1.2 1.2'
        });

        // Pridanie šípky nad objekt
        let arrow = document.createElement('a-image');
        arrow.setAttribute('src', '#arrow');
        arrow.setAttribute('position', '0 1 0'); // Umiestnenie nad objektom
        arrow.setAttribute('scale', '0.5 0.5 0.5');
        arrow.setAttribute('look-at', '#camera'); // Umožňuje šípke otáčať sa za kamerou
        document.querySelector(objectId).appendChild(arrow);
      }

      // Funkcia na simuláciu efektu písania
      function typeText(text, elementId, speed) {
        let wrappedText = wrapText(text, maxLineLength);
        let i = 0;
        const element = document.querySelector(elementId);
        element.setAttribute('text', 'value', ''); // Nastavenie prázdneho textu na začiatku
        const interval = setInterval(() => {
          if (i < wrappedText.length) {
            element.setAttribute('text', 'value', element.getAttribute('text').value + wrappedText.charAt(i));
            i++;
          } else {
            clearInterval(interval);
          }
        }, speed);
      }

      // Funkcia na rozdelenie textu na viacero riadkov
      function wrapText(text, maxLineLength) {
        const words = text.split(' ');
        let lines = [];
        let currentLine = '';

        words.forEach(word => {
          if ((currentLine + word).length <= maxLineLength) {
            currentLine += (currentLine ? ' ' : '') + word;
          } else {
            lines.push(currentLine);
            currentLine = word;
          }
        });

        lines.push(currentLine); // pridanie posledného riadku
        return lines.join('\n');
      }

      // Událosť na počúvanie stlačenia klávesy "P" alebo "O"
      document.addEventListener('keydown', function(event) {
        if (event.key.toLowerCase() === 'p') {
          updateStep();
        } else if (event.key.toLowerCase() === 'o') {
          previousStep();
        }
      });

      // Inicializácia prvého kroku
      updateStep();

    </script>

  </a-scene>
</body>
</html>
